{"version":3,"file":"embed-video.service.js","sources":["embed-video.service.js"],"names":[],"mappings":"AAAA;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAEO;AACP;AACA;;;;;0GAA0B;AAC1B;AACA;AACA;AACA","sourcesContent":["\"use strict\";\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar core_1 = require(\"@angular/core\");\nvar http_1 = require(\"@angular/common/http\");\nvar platform_browser_1 = require(\"@angular/platform-browser\");\nvar operators_1 = require(\"rxjs/operators\");\nvar EmbedVideoService = /** @class */ (function () {\n    function EmbedVideoService(http, sanitizer) {\n        this.http = http;\n        this.sanitizer = sanitizer;\n        this.validYouTubeOptions = [\n            'default',\n            'mqdefault',\n            'hqdefault',\n            'sddefault',\n            'maxresdefault'\n        ];\n        this.validVimeoOptions = [\n            'thumbnail_small',\n            'thumbnail_medium',\n            'thumbnail_large'\n        ];\n        this.validDailyMotionOptions = [\n            'thumbnail_60_url',\n            'thumbnail_120_url',\n            'thumbnail_180_url',\n            'thumbnail_240_url',\n            'thumbnail_360_url',\n            'thumbnail_480_url',\n            'thumbnail_720_url',\n            'thumbnail_1080_url'\n        ];\n    }\n    EmbedVideoService.prototype.embed = function (url, options) {\n        var id;\n        url = new URL(url);\n        id = this.detectYoutube(url);\n        if (id) {\n            return this.embed_youtube(id, options);\n        }\n        id = this.detectVimeo(url);\n        if (id) {\n            return this.embed_vimeo(id, options);\n        }\n        id = this.detectDailymotion(url);\n        if (id) {\n            return this.embed_dailymotion(id, options);\n        }\n    };\n    EmbedVideoService.prototype.embed_youtube = function (id, options) {\n        options = this.parseOptions(options);\n        return this.sanitize_iframe('<iframe src=\"https://www.youtube.com/embed/'\n            + id + options.query + '\"' + options.attr\n            + ' frameborder=\"0\" allowfullscreen></iframe>');\n    };\n    EmbedVideoService.prototype.embed_vimeo = function (id, options) {\n        options = this.parseOptions(options);\n        return this.sanitize_iframe('<iframe src=\"https://player.vimeo.com/video/'\n            + id + options.query + '\"' + options.attr\n            + ' frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>');\n    };\n    EmbedVideoService.prototype.embed_dailymotion = function (id, options) {\n        options = this.parseOptions(options);\n        return this.sanitize_iframe('<iframe src=\"https://www.dailymotion.com/embed/video/'\n            + id + options.query + '\"' + options.attr\n            + ' frameborder=\"0\" allowfullscreen></iframe>');\n    };\n    EmbedVideoService.prototype.embed_image = function (url, options) {\n        var id;\n        url = new URL(url);\n        id = this.detectYoutube(url);\n        if (id) {\n            return this.embed_youtube_image(id, options);\n        }\n        id = this.detectVimeo(url);\n        if (id) {\n            return this.embed_vimeo_image(id, options);\n        }\n        id = this.detectDailymotion(url);\n        if (id) {\n            return this.embed_dailymotion_image(id, options);\n        }\n    };\n    EmbedVideoService.prototype.embed_youtube_image = function (id, options) {\n        if (typeof options === 'function') {\n            options = {};\n        }\n        options = options || {};\n        options.image = this.validYouTubeOptions.indexOf(options.image) > 0 ? options.image : 'default';\n        var src = 'https://img.youtube.com/vi/' + id + '/' + options.image + '.jpg';\n        var result = {\n            link: src,\n            html: '<img src=\"' + src + '\"/>'\n        };\n        return new Promise(function (resolve) {\n            resolve(result);\n        });\n    };\n    EmbedVideoService.prototype.embed_vimeo_image = function (id, options) {\n        if (typeof options === 'function') {\n            options = {};\n        }\n        options = options || {};\n        options.image = this.validVimeoOptions.indexOf(options.image) >= 0 ? options.image : 'thumbnail_large';\n        return this.http.get('https://vimeo.com/api/v2/video/' + id + '.json').pipe(operators_1.map(function (res) {\n            return {\n                'link': res[0][options.image],\n                'html': '<img src=\"' + res[0][options.image] + '\"/>'\n            };\n        }))\n            .toPromise()\n            .catch(function (error) { return console.log(error); });\n    };\n    EmbedVideoService.prototype.embed_dailymotion_image = function (id, options) {\n        if (typeof options === 'function') {\n            options = {};\n        }\n        options = options || {};\n        options.image = this.validDailyMotionOptions.indexOf(options.image) >= 0 ? options.image : 'thumbnail_480_url';\n        return this.http.get('https://api.dailymotion.com/video/' + id + '?fields=' + options.image)\n            .pipe(operators_1.map(function (res) {\n            return {\n                'link': res[options.image],\n                'html': '<img src=\"' + res[options.image] + '\"/>'\n            };\n        }))\n            .toPromise()\n            .catch(function (error) { return console.log(error); });\n    };\n    EmbedVideoService.prototype.parseOptions = function (options) {\n        var queryString = '', attributes = '';\n        if (options && options.hasOwnProperty('query')) {\n            queryString = '?' + this.serializeQuery(options.query);\n        }\n        if (options && options.hasOwnProperty('attr')) {\n            var temp_1 = [];\n            Object.keys(options.attr).forEach(function (key) {\n                temp_1.push(key + '=\"' + (options.attr[key]) + '\"');\n            });\n            attributes = ' ' + temp_1.join(' ');\n        }\n        return {\n            query: queryString,\n            attr: attributes\n        };\n    };\n    EmbedVideoService.prototype.serializeQuery = function (query) {\n        var queryString = [];\n        for (var p in query) {\n            if (query.hasOwnProperty(p)) {\n                queryString.push(encodeURIComponent(p) + '=' + encodeURIComponent(query[p]));\n            }\n        }\n        return queryString.join('&');\n    };\n    EmbedVideoService.prototype.sanitize_iframe = function (iframe) {\n        return this.sanitizer.bypassSecurityTrustHtml(iframe);\n    };\n    EmbedVideoService.prototype.detectVimeo = function (url) {\n        return (url.hostname === 'vimeo.com') ? url.pathname.split('/')[1] : null;\n    };\n    EmbedVideoService.prototype.detectYoutube = function (url) {\n        if (url.hostname.indexOf('youtube.com') > -1) {\n            return url.search.split('=')[1];\n        }\n        if (url.hostname === 'youtu.be') {\n            return url.pathname.split('/')[1];\n        }\n        return '';\n    };\n    EmbedVideoService.prototype.detectDailymotion = function (url) {\n        if (url.hostname.indexOf('dailymotion.com') > -1) {\n            return url.pathname.split('/')[2].split('_')[0];\n        }\n        if (url.hostname === 'dai.ly') {\n            return url.pathname.split('/')[1];\n        }\n        return '';\n    };\n    EmbedVideoService = __decorate([\n        core_1.Injectable(),\n        __metadata(\"design:paramtypes\", [http_1.HttpClient,\n            platform_browser_1.DomSanitizer])\n    ], EmbedVideoService);\n    return EmbedVideoService;\n}());\nexports.EmbedVideoService = EmbedVideoService;\n"]}